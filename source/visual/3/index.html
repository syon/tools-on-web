<!DOCTYPE html>
<meta charset="utf-8">
<style type="text/css">
  .container {
    width: 900px;
    margin: 0 auto;
  }
  svg {
    border: 1px solid #eee;
  }
  pre {
    border-left: solid 2px #ccc;
    background-color: #f5f5f5;
    padding: 18px;
    margin: 2em 0 2em 0px;
    overflow-x: auto;
  }
</style>
<title>D3.jsと国土交通省のオープンデータで東京都の地図を描く</title>
<body>
  <div class="container">
    <h1>D3.jsと国土交通省のオープンデータで東京都の地図を描く</h1>
    <div id="map"></div>
    <p>
      Geograpic data is from <a href="http://nlftp.mlit.go.jp/ksj/gml/datalist/KsjTmplt-N03.html">国土交通省</a>.
      <br>
      This code is fork of <em><a href="http://qiita.com/sawamur@github/items/ec32237bcbaaba94108d">JavaScript - D3.jsとOpen Data〜その１地図を描画する - Qiita</a></em>.
    </p>
<pre>
    var g,
        width = 900,
        height = 650;

    // svg要素を作成し、データの受け皿となるg要素を追加している
    map = d3.select('#map').append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g');

    // 同じディレクトリにあるgeojsonファイルをhttp経由で読み込む    
    d3.json("tokyo.json", function(json) {
            var projection,
                 path;

            // 投影を処理する関数を用意する。データからSVGのPATHに変換するため。
            projection = d3.geo.mercator()
                  .scale(40000)
                  .center(d3.geo.centroid(json))  // データから中心点を計算
                  .translate([width / 2 + 100, height / 2 - 120]);

            // pathジェネレータ関数
            path = d3.geo.path().projection(projection);
            //  これがenterしたデータ毎に呼び出されpath要素のd属性に
            //  geoJSONデータから変換した値を入れる                

            map.selectAll('path')
            .data(json.features)
            .enter()
            .append('path')
            .attr('d', path)
            .attr("fill", function(d){
                // 適当に色を塗るなど
                return "hsl(147, 28%, 52%)";
            })
            .attr("stroke","hsl(147, 28%, 38%)" )
            .on('mouseover', function(d){
                // mouseoverの時のインタラクション
            })
            .on('click', function(d) {
                // clickされた時のインタラクション
            });
    });
</pre>
  </div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
(function() {
    var g,
        width = 900,
        height = 650;

    // svg要素を作成し、データの受け皿となるg要素を追加している
    map = d3.select('#map').append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g');

    // 同じディレクトリにあるgeojsonファイルをhttp経由で読み込む    
    d3.json("tokyo.json", function(json) {
            var projection,
                 path;

            // 投影を処理する関数を用意する。データからSVGのPATHに変換するため。
            projection = d3.geo.mercator()
                  .scale(40000)
                  .center(d3.geo.centroid(json))  // データから中心点を計算
                  .translate([width / 2 + 100, height / 2 - 120]);

            // pathジェネレータ関数
            path = d3.geo.path().projection(projection);
            //  これがenterしたデータ毎に呼び出されpath要素のd属性に
            //  geoJSONデータから変換した値を入れる                

            map.selectAll('path')
            .data(json.features)
            .enter()
            .append('path')
            .attr('d', path)
            .attr("fill", function(d){
                // 適当に色を塗るなど
                return "hsl(147, 28%, 52%)";
            })
            .attr("stroke","hsl(147, 28%, 38%)" )
            .on('mouseover', function(d){
                // mouseoverの時のインタラクション
            })
            .on('click', function(d) {
                // clickされた時のインタラクション
            });
    });
})();
</script>
</body>
